
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Normalize script</title><meta name="generator" content="MATLAB 9.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2017-05-02"><meta name="DC.source" content="normalllll_publish_temp_delete_me.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Normalize script</h1><!--introduction--><p>or how I came up of the random constants that use to multiple the data.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Average skeleton displacement as a mean of sorts</a></li><li><a href="#6">Normalizing sizes</a></li><li><a href="#15">Results after normalizing the dataset:</a></li></ul></div><h2 id="1">Average skeleton displacement as a mean of sorts</h2><p>First one must notice that a skeleton in the dataset has always an initial displacement which we will neglect, as a translated action in space represents the same action.</p><p>We can see this from a random sample of skeletons from our data-set.</p><pre class="codeinput">load_test_skel

[~, A] = skeldraw(a, false);
plot3(A(1,:),A(2,:), A(3,:))


<span class="comment">%insert pic of several skeletons everywhere</span>
</pre><pre class="codeoutput">
ans = 

  struct with fields:

               SLASH: '\\'
          pathtodata: 'E:\fall_detection_datasets\TST Fall detection database ver. 2\'
    wheretosavestuff: 'e:\\savesave'
            homepath: 'C:\\Users\\Frederico\\Documents\\GitHub\\classifier'

</pre><img vspace="5" hspace="5" src="normalllll_publish_temp_delete_me_01.png" alt=""> <p>Based on Parisi's 2015 Paper, we chose the center of the hips to make our origin and subtracted that from all the data the sample output from the test function in conformskel shows us also the skeletons after they're centred:</p><pre class="codeinput">bb.data = a(:,1);
aa.data = a(:,2:end);
[centralized_a, ~] = conformskel(aa, <span class="string">'nohips'</span>);
[~, centralized_A] = skeldraw(centralized_a.data,false);
hold <span class="string">on</span>
plot3(centralized_A(1,:),centralized_A(2,:), centralized_A(3,:))
hold <span class="string">off</span>
</pre><pre class="codeoutput">Warning: no y? 
Warning: no y? 
</pre><img vspace="5" hspace="5" src="normalllll_publish_temp_delete_me_02.png" alt=""> <p>Or just the centralized skeletons:</p><pre class="codeinput">plot3(centralized_A(1,:),centralized_A(2,:), centralized_A(3,:))
</pre><img vspace="5" hspace="5" src="normalllll_publish_temp_delete_me_03.png" alt=""> <p>Now, since we want translation invariance, let's apply that to the data-set before we proceed any further with our inquiries.</p><pre class="codeinput">load_skel_data <span class="comment">% loads skeleton dataset</span>

[nohips_train, nohips_val] = conformskel(data_train, data_val,<span class="string">'nohips'</span>);

data = [nohips_val nohips_train];

allskels = makefatskel(data); <span class="comment">% reshapes the skeletons in a more convenient 50x3xN array</span>
</pre><pre class="codeoutput error">Undefined function or variable 'load_skel_data'.

Error in normalllll_publish_temp_delete_me (line 41)
load_skel_data % loads skeleton dataset 
</pre><h2 id="6">Normalizing sizes</h2><p>Even after normalizing for displacement, we can see from examining a point from our data-set that the array has some peculiarities. For example:</p><pre class="codeinput">allskels(:,:,2)
</pre><p>We can clearly see from the output that the first 24 lines have numbers that are much bigger then the second 25:end part. To correct this unwanted abnormality - and since the units don't carry any other importance here, but they are an integral part of the GWR algorithm (the activations depends on the exponential of the distance) - we will multiply them by suitable constants. In order to find out what these constants are, we will use the avarage standard deviation from these, as a measure.</p><pre class="codeinput">vectdata_pos = reshape(allskels(1:24,:,:),1,[]);
pos_std = std(vectdata_pos)
</pre><p>For the skeletons.</p><pre class="codeinput">vectdata_vel = reshape(allskels(25:end,:,:),1,[]);
vel_std = std(vectdata_vel)
</pre><p>And for the velocities.</p><p>Another approach that seemed reasonable was to write it as:</p><pre class="codeinput">mean_pos_std = mean(mean(std(allskels(1:24,:,:))))
</pre><p>For the skeletons.</p><pre class="codeinput">mean_vel_std = mean(mean(std(allskels(25:end,:,:))))
</pre><p>And for the velocities.</p><p>But we notice that their ratio has around the same order of magnitude:</p><pre class="codeinput">pos_std/vel_std

mean_pos_std/mean_vel_std
</pre><p>So since they are multiplication factors, these will likely not make too much of a difference. There are likely to be other more sensible approaxes here, but our intention is only having some similarity, which we still don't have. They algorithm performs somehow even with these very big differences, so we suppose that for our needs this measure will suffice. The output of these functions were used to construct the 'normal' function, that is, pos_std was used to normalize the skeleton data (lines 1:24) and vel_std to normalize the velocities (lines 25:49).</p><h2 id="15">Results after normalizing the dataset:</h2><pre class="codeinput">[normal_train, normal_val] = conformskel(data_train, data_val,<span class="string">'nohips'</span>,<span class="string">'normal'</span>);

nodata = normal_train;<span class="comment">%[normal_train, normal_val];</span>
</pre><p>Now we want to verify if our procedures were effective in removing this:</p><pre class="codeinput">noallskels = makefatskel(nodata);
noallskels(:,:,2)
</pre><p>And also our measures:</p><pre class="codeinput">vectdata_pos = reshape(noallskels(1:24,:,:),1,[]);
pos_std = std(vectdata_pos)
vectdata_vel = reshape(noallskels(25:end,:,:),1,[]);
vel_std = std(vectdata_vel)
</pre><pre class="codeinput">mean_pos_std = mean(mean(std(noallskels(1:24,:,:))))
mean_vel_std = mean(mean(std(noallskels(25:end,:,:))))
</pre><p>And what happened to their ratios:</p><pre class="codeinput">pos_std/vel_std

mean_pos_std/mean_vel_std
</pre><p>Perhaps it is more interesting to see what happened to the data with a plot. This can be easily done with the skeldraw function. But instead of doing it on the whole dataset, let's just do it on our small test set:</p><pre class="codeinput">[normalized_a, ~] = conformskel(a, b , <span class="string">'nohips'</span>, <span class="string">'normal'</span>);
normalized_A = skeldraw(normalized_a,false);
plot3(normalized_A(1,:),normalized_A(2,:), normalized_A(3,:))
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2017a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Normalize script
% or how I came up of the random constants that use to multiple the data. 



%% Average skeleton displacement as a mean of sorts
% First one must notice that a skeleton in the dataset has always an
% initial displacement which we will neglect, as a translated action in
% space represents the same action. 

%% 
% We can see this from a random sample of skeletons from our data-set.
load_test_skel

[~, A] = skeldraw(a, false);
plot3(A(1,:),A(2,:), A(3,:))


%insert pic of several skeletons everywhere

%% 
% Based on Parisi's 2015 Paper, we chose the center of the hips to make our origin and subtracted that from all the data
% the sample output from the test function in conformskel shows us also the
% skeletons after they're centred:

bb.data = a(:,1);
aa.data = a(:,2:end);
[centralized_a, ~] = conformskel(aa, 'nohips');
[~, centralized_A] = skeldraw(centralized_a.data,false);
hold on
plot3(centralized_A(1,:),centralized_A(2,:), centralized_A(3,:))
hold off
%%
% Or just the centralized skeletons:
plot3(centralized_A(1,:),centralized_A(2,:), centralized_A(3,:))

%%
% Now, since we want translation invariance, let's apply that to the
% data-set before we proceed any further with our inquiries.

load_skel_data % loads skeleton dataset 

[nohips_train, nohips_val] = conformskel(data_train, data_val,'nohips');

data = [nohips_val nohips_train];

allskels = makefatskel(data); % reshapes the skeletons in a more convenient 50x3xN array


%% Normalizing sizes
% Even after normalizing for displacement, we can see from examining a point from our data-set that the array has
% some peculiarities. For example:

allskels(:,:,2)

%%
% We can clearly see from the output that the first 24 lines have numbers that are
% much bigger then the second 25:end part.
% To correct this unwanted abnormality - and since the units
% don't carry any other importance here, but they are an integral part of
% the GWR algorithm (the activations depends on the exponential of the
% distance) - we will multiply them by suitable constants. In order to find
% out what these constants are, we will use the avarage standard deviation from
% these, as a measure.

vectdata_pos = reshape(allskels(1:24,:,:),1,[]);
pos_std = std(vectdata_pos)

%%
% For the skeletons.

vectdata_vel = reshape(allskels(25:end,:,:),1,[]);
vel_std = std(vectdata_vel)

%%
% And for the velocities.

%%
% Another approach that seemed reasonable was to write it as:

mean_pos_std = mean(mean(std(allskels(1:24,:,:))))

%%
% For the skeletons.

mean_vel_std = mean(mean(std(allskels(25:end,:,:))))

%%
% And for the velocities.

%%
% But we notice that their ratio has around the same order of magnitude:

pos_std/vel_std

mean_pos_std/mean_vel_std

%%
% So since they are multiplication factors, these will likely not make too
% much of a difference.
% There are likely to be other more sensible approaxes here, but our intention is
% only having some similarity, which we still don't have. They algorithm
% performs somehow even with these very big differences, so we suppose that
% for our needs this measure will suffice.
% The output of these functions were used to construct the 'normal'
% function, that is, pos_std was used to normalize the skeleton data (lines
% 1:24) and vel_std to normalize the velocities (lines 25:49).

%% Results after normalizing the dataset:

[normal_train, normal_val] = conformskel(data_train, data_val,'nohips','normal');

nodata = normal_train;%[normal_train, normal_val];

%%
% Now we want to verify if our procedures were effective in removing this:

noallskels = makefatskel(nodata);
noallskels(:,:,2)
%%
% And also our measures:

vectdata_pos = reshape(noallskels(1:24,:,:),1,[]);
pos_std = std(vectdata_pos)
vectdata_vel = reshape(noallskels(25:end,:,:),1,[]);
vel_std = std(vectdata_vel)

%%

mean_pos_std = mean(mean(std(noallskels(1:24,:,:))))
mean_vel_std = mean(mean(std(noallskels(25:end,:,:))))

%%
% And what happened to their ratios:

pos_std/vel_std

mean_pos_std/mean_vel_std

%%
% Perhaps it is more interesting to see what happened to the data with a
% plot. This can be easily done with the skeldraw function.
% But instead of doing it on the whole dataset, let's just do it on our
% small test set:
[normalized_a, ~] = conformskel(a, b , 'nohips', 'normal');
normalized_A = skeldraw(normalized_a,false);
plot3(normalized_A(1,:),normalized_A(2,:), normalized_A(3,:))
##### SOURCE END #####
--></body></html>